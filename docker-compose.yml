# ===========================================
# Docker Compose - Web Scraper Application
# ===========================================
# Chạy: docker compose up -d
# Xem logs: docker compose logs -f web
# Dừng: docker compose down

version: '3.8'

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: web-scraper
    restart: unless-stopped
    ports:
      - "${FLASK_PORT:-5000}:5000"
    environment:
      # Flask Configuration
      - SECRET_KEY=${SECRET_KEY:-change-this-secret-key-in-production}
      - FLASK_DEBUG=False
      - FLASK_ENV=production
      
      # Database (SQLite trong container)
      - DATABASE_URL=sqlite:///scraper.db
      
      # Scraper Configuration
      - HEADLESS_MODE=True
      - SCROLL_PAUSE_TIME=${SCROLL_PAUSE_TIME:-2.5}
      - MAX_SCROLL_COUNT=${MAX_SCROLL_COUNT:-10}
      
      # Chrome/Selenium Configuration
      - CHROME_BIN=/usr/bin/google-chrome
      - CHROMEDRIVER_PATH=/usr/bin/chromedriver
    volumes:
      # Persist database
      - scraper_data:/app/instance
    # Giới hạn resources (tùy chỉnh theo server)
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M
    # Security options cho Chrome
    security_opt:
      - seccomp:unconfined
    # Shared memory cho Chrome
    shm_size: '2gb'

volumes:
  scraper_data:
    driver: local
